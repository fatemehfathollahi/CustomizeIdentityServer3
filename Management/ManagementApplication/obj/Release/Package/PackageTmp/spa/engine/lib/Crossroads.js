function validateListener(n,t){if(typeof n!="function")throw new Error("listener is a required param of {fn}() and should be a Function.".replace("{fn}",t));}function Signal(){this._bindings=[];this._prevParams=null;var n=this;this.dispatch=function(){Signal.prototype.dispatch.apply(n,arguments)}}function SignalBinding(n,t,i,r,u){this._listener=t;this._isOnce=i;this.context=r;this._signal=n;this._priority=u||0}function Route(n,t,i,r){var u=isRegExp(n),f=r.patternLexer;this._router=r;this._pattern=n;this._paramsIds=u?null:f.getParamIds(n);this._optionalParamsIds=u?null:f.getOptionalParamsIds(n);this._matchRegexp=u?n:f.compilePattern(n,r.ignoreCase);this.matched=new signals.Signal;this.switched=new signals.Signal;t&&this.matched.add(t);this._priority=i||0}function arrayIndexOf(n,t){if(n.indexOf)return n.indexOf(t);for(var i=n.length;i--;)if(n[i]===t)return i;return-1}function arrayRemove(n,t){var i=arrayIndexOf(n,t);i!==-1&&n.splice(i,1)}function isKind(n,t){return"[object "+t+"]"===Object.prototype.toString.call(n)}function isRegExp(n){return isKind(n,"RegExp")}function isArray(n){return isKind(n,"Array")}function isFunction(n){return typeof n=="function"}function typecastValue(n){return n===null||n==="null"?null:n==="true"?!0:n==="false"?!1:n===UNDEF||n==="undefined"?UNDEF:n===""||isNaN(n)?n:parseFloat(n)}function typecastArrayValues(n){for(var t=n.length,i=[];t--;)i[t]=typecastValue(n[t]);return i}function decodeQueryString(n,t){for(var u=(n||"").replace("?","").split("&"),f=u.length,e={},i,r;f--;)i=u[f].split("="),r=t?typecastValue(i[1]):i[1],e[i[0]]=typeof r=="string"?decodeURIComponent(r):r;return e}function Crossroads(){this.bypassed=new signals.Signal;this.routed=new signals.Signal;this._routes=[];this._prevRoutes=[];this._piped=[];this.resetState()}var signals,hasher,crossroads,_hasOptionalGroupBug,UNDEF;Signal.prototype={VERSION:"::VERSION_NUMBER::",memorize:!1,_shouldPropagate:!0,active:!0,_registerListener:function(n,t,i,r){var f=this._indexOfListener(n,i),u;if(f!==-1){if(u=this._bindings[f],u.isOnce()!==t)throw new Error("You cannot add"+(t?"":"Once")+"() then add"+(t?"Once":"")+"() the same listener without removing the relationship first.");}else u=new SignalBinding(this,n,t,i,r),this._addBinding(u);return this.memorize&&this._prevParams&&u.execute(this._prevParams),u},_addBinding:function(n){var t=this._bindings.length;do--t;while(this._bindings[t]&&n._priority<=this._bindings[t]._priority);this._bindings.splice(t+1,0,n)},_indexOfListener:function(n,t){for(var i=this._bindings.length,r;i--;)if(r=this._bindings[i],r._listener===n&&r.context===t)return i;return-1},has:function(n,t){return this._indexOfListener(n,t)!==-1},add:function(n,t,i){return validateListener(n,"add"),this._registerListener(n,!1,t,i)},addOnce:function(n,t,i){return validateListener(n,"addOnce"),this._registerListener(n,!0,t,i)},remove:function(n,t){validateListener(n,"remove");var i=this._indexOfListener(n,t);return i!==-1&&(this._bindings[i]._destroy(),this._bindings.splice(i,1)),n},removeAll:function(){for(var n=this._bindings.length;n--;)this._bindings[n]._destroy();this._bindings.length=0},getNumListeners:function(){return this._bindings.length},halt:function(){this._shouldPropagate=!1},dispatch:function(){if(this.active){var i=Array.prototype.slice.call(arguments),n=this._bindings.length,t;if(this.memorize&&(this._prevParams=i),n){t=this._bindings.slice();this._shouldPropagate=!0;do n--;while(t[n]&&this._shouldPropagate&&t[n].execute(i)!==!1)}}},forget:function(){this._prevParams=null},dispose:function(){this.removeAll();delete this._bindings;delete this._prevParams},toString:function(){return"[Signal active:"+this.active+" numListeners:"+this.getNumListeners()+"]"}};signals=Signal;signals.Signal=Signal;SignalBinding.prototype={active:!0,params:null,execute:function(n){var t,i;return this.active&&!!this._listener&&(i=this.params?this.params.concat(n):n,t=this._listener.apply(this.context,i),this._isOnce&&this.detach()),t},detach:function(){return this.isBound()?this._signal.remove(this._listener,this.context):null},isBound:function(){return!!this._signal&&!!this._listener},isOnce:function(){return this._isOnce},getListener:function(){return this._listener},getSignal:function(){return this._signal},_destroy:function(){delete this._signal;delete this._listener;delete this.context},toString:function(){return"[SignalBinding isOnce:"+this._isOnce+", isBound:"+this.isBound()+", active:"+this.active+"]"}};hasher=function(n){function p(n){return String(n||"").replace(/\W/g,"\\$&")}function u(n){if(!n)return"";var i=new RegExp("^"+p(t.prependHash)+"|"+p(t.appendHash)+"$","g");return n.replace(i,"")}function v(){var i=nt.exec(t.getURL()),n=i&&i[1]||"";try{return t.raw?n:decodeURIComponent(n)}catch(r){return n}}function w(){return r?r.contentWindow.frameHash:null}function ut(){r=e.createElement("iframe");r.src="about:blank";r.style.display="none";e.body.appendChild(r)}function b(){if(r&&i!==w()){var n=r.contentWindow.document;n.open();n.write("<html><head><title>"+e.title+'<\/title><script type="text/javascript">var frameHash="'+i+'";<\/script><\/head><body>&nbsp;<\/body><\/html>');n.close()}}function s(n,f){if(i!==n){var e=i;i=n;a&&(f?r.contentWindow.frameHash=n:b());t.changed.dispatch(u(n),u(e))}}function ft(n,t,i){n.addEventListener?n.addEventListener(t,i,!1):n.attachEvent&&n.attachEvent("on"+t,i)}function et(n,t,i){n.removeEventListener?n.removeEventListener(t,i,!1):n.detachEvent&&n.detachEvent("on"+t,i)}function k(n){n=Array.prototype.slice.call(arguments);var i=n.join(t.separator);return i?t.prependHash+i.replace(it,"")+t.appendHash:i}function d(n){return n=encodeURI(n),y&&rt&&(n=n.replace(/\?/,"%3F")),n}var g=25,e=n.document,ot=n.history,h=signals.Signal,t,i,c,f,r,o,nt=/#(.*)$/,tt=/(\?.*)|(\#.*)/,it=/^\#/,y=!+"\v1",l="onhashchange"in n&&e.documentMode!==7,a=y&&!l,rt=location.protocol==="file:";return o=a?function(){var n=v(),r=w();r!==i&&r!==n?t.setHash(u(r)):n!==i&&s(n)}:function(){var n=v();n!==i&&s(n)},t={VERSION:"::VERSION_NUMBER::",raw:!1,appendHash:"",prependHash:"/",separator:"/",changed:new h,stopped:new h,initialized:new h,init:function(){f||(i=v(),l?ft(n,"hashchange",o):(a&&(r||ut(),b()),c=setInterval(o,g)),f=!0,t.initialized.dispatch(u(i)))},stop:function(){f&&(l?et(n,"hashchange",o):(clearInterval(c),c=null),f=!1,t.stopped.dispatch(u(i)))},isActive:function(){return f},getURL:function(){return n.location.href},getBaseURL:function(){return t.getURL().replace(tt,"")},setHash:function(r){r=k.apply(null,arguments);r!==i&&(s(r),r===i&&(t.raw||(r=d(r)),n.location.hash="#"+r))},replaceHash:function(r){r=k.apply(null,arguments);r!==i&&(s(r,!0),r===i&&(t.raw||(r=d(r)),n.location.replace("#"+r)))},getHash:function(){return u(i)},getHashAsArray:function(){return t.getHash().split(t.separator)},dispose:function(){t.stop();t.initialized.dispose();t.stopped.dispose();t.changed.dispose();r=t=n.hasher=null},toString:function(){return'[hasher version="'+t.VERSION+'" hash="'+t.getHash()+'"]'}},t.initialized.memorize=!0,t}(window);Route.prototype={greedy:!1,rules:void 0,match:function(n){return n=n||"",this._matchRegexp.test(n)&&this._validateParams(n)},_validateParams:function(n){var i=this.rules,r=this._getParamsObject(n),t;for(t in i)if(t!=="normalize_"&&i.hasOwnProperty(t)&&!this._isValidParam(n,t,r))return!1;return!0},_isValidParam:function(n,t,i){var r=this.rules[t],u=i[t],f=!1,e=t.indexOf("?")===0;return u==null&&this._optionalParamsIds&&arrayIndexOf(this._optionalParamsIds,t)!==-1?f=!0:isRegExp(r)?(e&&(u=i[t+"_"]),f=r.test(u)):isArray(r)?(e&&(u=i[t+"_"]),f=this._isValidArrayRule(r,u)):isFunction(r)&&(f=r(u,n,i)),f},_isValidArrayRule:function(n,t){if(!this._router.ignoreCase)return arrayIndexOf(n,t)!==-1;typeof t=="string"&&(t=t.toLowerCase());for(var r=n.length,i,u;r--;)if(i=n[r],u=typeof i=="string"?i.toLowerCase():i,u===t)return!0;return!1},_getParamsObject:function(n){for(var e=this._router.shouldTypecast,u=this._router.patternLexer.getParamValues(n,this._matchRegexp,e),i={},r=u.length,f,t;r--;)t=u[r],this._paramsIds&&(f=this._paramsIds[r],f.indexOf("?")===0&&t&&(i[f+"_"]=t,t=decodeQueryString(t,e),u[r]=t),_hasOptionalGroupBug&&t===""&&arrayIndexOf(this._optionalParamsIds,f)!==-1&&(t=void 0,u[r]=t),i[f]=t),i[r]=t;return i.request_=e?typecastValue(n):n,i.vals_=u,i},_getParamsArray:function(n){var t=this.rules?this.rules.normalize_:null;return t=t||this._router.normalizeFn,t&&isFunction(t)?t(n,this._getParamsObject(n)):this._getParamsObject(n).vals_},interpolate:function(n){var t=this._router.patternLexer.interpolate(this._pattern,n);if(!this._validateParams(t))throw new Error("Generated string doesn't validate against `Route.rules`.");return t},dispose:function(){this._router.removeRoute(this)},_destroy:function(){this.matched.dispose();this.switched.dispose();this.matched=this.switched=this._pattern=this._matchRegexp=null},toString:function(){return'[Route pattern:"'+this._pattern+'", numListeners:'+this.matched.getNumListeners()+"]"}};_hasOptionalGroupBug=/t(.+)?/.exec("t")[1]==="";Crossroads.prototype={greedy:!1,greedyEnabled:!0,ignoreCase:!0,ignoreState:!1,shouldTypecast:!1,normalizeFn:null,resetState:function(){this._prevRoutes.length=0;this._prevMatchedRequest=null;this._prevBypassedRequest=null},create:function(){return new Crossroads},addRoute:function(n,t,i){var r=new Route(n,t,i,this);return this._sortedInsert(r),r},removeRoute:function(n){arrayRemove(this._routes,n);n._destroy()},removeAllRoutes:function(){for(var n=this.getNumRoutes();n--;)this._routes[n]._destroy();this._routes.length=0},parse:function(n,t){if(n=n||"",t=t||[],this.ignoreState||n!==this._prevMatchedRequest&&n!==this._prevBypassedRequest){var r=this._getMatchedRoutes(n),u=0,f=r.length,i;if(f)for(this._prevMatchedRequest=n,this._notifyPrevRoutes(r,n),this._prevRoutes=r;u<f;)i=r[u],i.route.matched.dispatch.apply(i.route.matched,t.concat(i.params)),i.isFirst=!u,this.routed.dispatch.apply(this.routed,t.concat([n,i])),u+=1;else this._prevBypassedRequest=n,this.bypassed.dispatch.apply(this.bypassed,t.concat([n]));this._pipeParse(n,t)}},_notifyPrevRoutes:function(n,t){for(var r=0,i;i=this._prevRoutes[r++];)i.route.switched&&this._didSwitch(i.route,n)&&i.route.switched.dispatch(t)},_didSwitch:function(n,t){for(var i,r=0;i=t[r++];)if(i.route===n)return!1;return!0},_pipeParse:function(n,t){for(var r=0,i;i=this._piped[r++];)i.parse(n,t)},getNumRoutes:function(){return this._routes.length},_sortedInsert:function(n){var t=this._routes,i=t.length;do--i;while(t[i]&&n._priority<=t[i]._priority);t.splice(i+1,0,n)},_getMatchedRoutes:function(n){for(var i=[],r=this._routes,u=r.length,t;t=r[--u];)if((!i.length||this.greedy||t.greedy)&&t.match(n)&&i.push({route:t,params:t._getParamsArray(n)}),!this.greedyEnabled&&i.length)break;return i},pipe:function(n){this._piped.push(n)},unpipe:function(n){arrayRemove(this._piped,n)},toString:function(){return"[crossroads numRoutes:"+this.getNumRoutes()+"]"}};crossroads=new Crossroads;crossroads.VERSION="::VERSION_NUMBER::";crossroads.NORM_AS_ARRAY=function(n,t){return[t.vals_]};crossroads.NORM_AS_OBJECT=function(n,t){return[t]};Crossroads.prototype.patternLexer=function(){function l(){var i,t;for(i in n)n.hasOwnProperty(i)&&(t=n[i],t.id="__CR_"+i+"__",t.save="save"in t?t.save.replace("{{id}}",t.id):t.id,t.rRestore=new RegExp(t.id,"g"))}function e(n,t){var i=[],r;for(n.lastIndex=0;r=n.exec(t);)i.push(r[1]);return i}function a(n){return e(r,n)}function v(t){return e(n.OP.rgx,t)}function y(n,r){return n=n||"",n&&(t===i?n=n.replace(h,""):t===f&&(n=n.replace(c,"")),n=o(n,"rgx","save"),n=n.replace(s,"\\$&"),n=o(n,"rRestore","res"),t===i&&(n="\\/?"+n)),t!==u&&(n+="\\/?"),new RegExp("^"+n+"$",r?"i":"")}function o(t,i,r){var u,f;for(f in n)n.hasOwnProperty(f)&&(u=n[f],t=t.replace(u[i],u[r]));return t}function p(n,t,i){var r=t.exec(n);return r&&(r.shift(),i&&(r=typecastArrayValues(r))),r}function w(t,i){if(typeof t!="string")throw new Error("Route pattern should be a string.");var u=function(n,t){var r,u,f;if(t=t.substr(0,1)==="?"?t.substr(1):t,i[t]!=null){if(typeof i[t]=="object"){u=[];for(f in i[t])u.push(encodeURI(f+"="+i[t][f]));r="?"+u.join("&")}else r=String(i[t]);if(n.indexOf("*")===-1&&r.indexOf("/")!==-1)throw new Error('Invalid value "'+r+'" for segment "'+n+'".');}else if(n.indexOf("{")!==-1)throw new Error("The segment "+n+" is required.");else r="";return r};return n.OS.trail||(n.OS.trail=new RegExp("(?:"+n.OS.id+")+$")),t.replace(n.OS.rgx,n.OS.save).replace(r,u).replace(n.OS.trail,"").replace(n.OS.rRestore,"/")}var s=/[\\.+*?\^$\[\](){}\/'#]/g,h=/^\/|\/$/g,c=/\/$/g,r=/(?:\{|:)([^}:]+)(?:\}|:)/g,n={OS:{rgx:/([:}]|\w(?=\/))\/?(:|(?:\{\?))/g,save:"$1{{id}}$2",res:"\\/?"},RS:{rgx:/([:}])\/?(\{)/g,save:"$1{{id}}$2",res:"\\/"},RQ:{rgx:/\{\?([^}]+)\}/g,res:"\\?([^#]+)"},OQ:{rgx:/:\?([^:]+):/g,res:"(?:\\?([^#]*))?"},OR:{rgx:/:([^:]+)\*:/g,res:"(.*)?"},RR:{rgx:/\{([^}]+)\*\}/g,res:"(.+)"},RP:{rgx:/\{([^}]+)\}/g,res:"([^\\/?]+)"},OP:{rgx:/:([^:]+):/g,res:"([^\\/?]+)?/?"}},i=1,u=2,f=3,t=i;return l(),{strict:function(){t=u},loose:function(){t=i},legacy:function(){t=f},getParamIds:a,getOptionalParamsIds:v,getParamValues:p,compilePattern:y,interpolate:w}}()